name: Secret Leakage Detection

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  secret-scan:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Scan for hardcoded secrets
      run: |
        echo "Scanning for potential hardcoded secrets..."
        # Check for common secret patterns
        if grep -r --exclude-dir=.git --exclude-dir=node_modules --exclude-dir=__pycache__ --exclude-dir=.pytest_cache --exclude-dir=.venv --exclude-dir=venv --exclude-dir=.ven --exclude-dir=.vvenv --exclude-dir=.venv_old --exclude-dir=.venv_cli --exclude-dir=.vvenv -i "password\|token\|secret\|api_key\|access_token\|auth_key" . | grep -v ".github/workflows" | grep -v "SECURITY.md" | grep -v "README.md" | grep -v ".env.example" | grep -v "check_password.py"; then
          echo "❌ Potential hardcoded secrets found!"
          exit 1
        else
          echo "✅ No hardcoded secrets detected."
        fi
